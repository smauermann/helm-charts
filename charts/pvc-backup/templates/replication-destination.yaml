{{- if .Values.restore.enabled }}
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/volsync.backube/replicationdestination_v1alpha1.json
---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationDestination
metadata:
  name: {{ .Values.appName }}-restore-b2
  labels:
    {{- include "chart.labels" . | nindent 4 }}
spec:
  trigger:
    manual: {{ .Values.restore.trigger | quote }}
  restic:
    destinationPVC: {{ .Values.restore.destinationPVC | default .Values.pvcName }}
    repository: {{ .Values.appName }}-volsync-b2
    copyMethod: {{ .Values.restore.copyMethod }}
    {{- with .Values.restore.restoreAsOf }}
    restoreAsOf: {{ . | quote }}
    {{- end }}
    {{- with .Values.restore.enableFileDeletion }}
    enableFileDeletion: {{ . }}
    {{- end }}
    cacheCapacity: {{ .Values.restore.cacheCapacity | default .Values.backup.cacheCapacity }}
    cacheStorageClassName: {{ .Values.restore.cacheStorageClassName | default .Values.backup.cacheStorageClassName }}
    moverSecurityContext:
      runAsUser: {{ .Values.restic.runAsUser }}
      runAsGroup: {{ .Values.restic.runAsGroup }}
      fsGroup: {{ .Values.restic.fsGroup }}
      fsGroupChangePolicy: Always
    storageClassName: {{ .Values.restore.storageClassName | default .Values.backup.storageClassName }}
    {{- with .Values.restore.cleanupCachePVC }}
    cleanupCachePVC: {{ . }}
    {{- end }}
    {{- with .Values.restore.cleanupTempPVC }}
    cleanupTempPVC: {{ . }}
    {{- end }}
{{- end }}
