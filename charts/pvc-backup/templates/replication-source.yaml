# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/volsync.backube/replicationsource_v1alpha1.json
---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: {{ .Values.appName }}-data-b2
  labels:
    {{- include "chart.labels" . | nindent 4 }}
spec:
  sourcePVC: {{ .Values.pvcName }}
  trigger:
    schedule: {{ .Values.backup.schedule | quote }}
  restic:
    cacheCapacity: {{ .Values.backup.cacheCapacity }}
    copyMethod: Snapshot
    moverSecurityContext:
      runAsUser: {{ .Values.restic.runAsUser }}
      runAsGroup: {{ .Values.restic.runAsGroup }}
      fsGroup: {{ .Values.restic.fsGroup }}
      fsGroupChangePolicy: Always
    pruneIntervalDays: {{ .Values.backup.pruneIntervalDays }}
    retain:
      daily: {{ .Values.backup.retain.daily }}
      weekly: {{ .Values.backup.retain.weekly }}
    repository: {{ .Values.appName }}-volsync-b2
    storageClassName: {{ .Values.backup.storageClassName }}
    volumeSnapshotClassName: {{ .Values.backup.volumeSnapshotClassName }}
